<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homework 2</title>
  <!-- 引入 D3 -->
  <script src="./js/d3.min.js" charset="utf-8"></script>

  <style>
    .tooltip {
      position: absolute;
      text-align: center;
      width: 60px;
      height: 28px;
      padding: 2px;
      font: 12px sans-serif;
      background: lightsteelblue;
      border: 0px;
      border-radius: 8px;
      pointer-events: none;
    }

    .d3-tip {
      line-height: 1;
      font-weight: bold;
      padding: 12px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      border-radius: 2px;
    }
  </style>
</head>

<body>

  <!-- 添加一个带有 id="heatmap" 的 div 元素 -->
  <div id="heatmap"></div>

  <script>

// 首先定义数据
var data = [
      [0.2, 0.4, 0.5, 0.7, 0.3],
      [0.3, 0.5, 0.6, 0.8, 0.4],
      [0.1, 0.3, 0.4, 0.5, 0.6],
      [0.5, 0.7, 0.8, 0.9, 0.2],
      [0.7, 0.1, 0.2, 0.3, 0.4]
    ];


  d3.csv("temperature.csv", function(error, data) {
  if (error) throw error;

  // 在这里对 data 进行处理和转换，例如转换为数值类型等

  // 在这里使用 data 来绘制热力图
});


    // 设置画布大小
    var margin = { top: 20, right: 20, bottom: 20, left: 20 },
      width = 400 - margin.left - margin.right,
      height = 400 - margin.top - margin.bottom;

    // 创建 SVG 元素
    var svg = d3.select("#heatmap")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


    // 定义颜色比例尺
    var colorScale = d3.scaleLinear()
      .domain([d3.min(data, function(d) { return d3.min(d); }), d3.max(data, function(d) { return d3.max(d); })])
      .range(["#d6eaf8", "#21618c"]);

    // 定义每个单元格的大小
    var gridSize = Math.min(width / data[0].length, height / data.length);

    // 定义 tooltip
    var tooltip = d3.select("body")
      .append("div")
      .attr("class", "tooltip")
      .style("opacity", 0);

    // 绘制热力图
    var heatmap = svg.selectAll(".heatmap")
      .data(data)
      .enter().append("g")
      .attr("class", "heatmap")
      .attr("transform", function(d, i) { return "translate(0," + i * gridSize + ")"; });

    heatmap.selectAll("rect")
      .data(function(d) { return d; })
      .enter().append("rect")
      .attr("x", function(d, i) { return i * gridSize; })
      .attr("y", 0)
      .attr("width", gridSize)
      .attr("height", gridSize)
      .style("fill", function(d) { return colorScale(d); })
      .on("mouseover", function() {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html(d3.select(this).data()[0])
          .style("left", (d3.event.pageX) + "px")
          .style("top", (d3.event.pageY - 28) + "px");
      })
      .on("mouseout", function() {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });
</script>

</body>
</html>